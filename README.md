# Video Sequence Matching Service

## Overview

The Video Sequence Matching Service is designed to identify repeated sequences in video feeds by analyzing low-dimensional representations of the video data, generated by a Neural Network. The service compares bitwise XOR values to detect matches and is architected using microservices coordinated through Kafka and managed by Kubernetes for high availability and scalability.

## System Architecture

![System Architecture](/architecture.png)

### Components

#### Video Producer
- Generates 1024-bit representations of video sequences.
- Publishes [Video](#video) to Kafka cluster.

#### Database Service
- Stores video data using Redis for caching and Disk for persistence.
- Subscribes to Kafka topic to receive [Video](#video).

#### Matching Services
- Processes video data to find repeated sequences in a given time range.
- Scores potential matches and publishes results back to Kafka.
- Subscribes to Kafka topic to receive [Video](#video).
- Publishes [Report](#report) to Kafka cluster.

#### Report Consumer
- Receives [Report](#report) from Kafka cluster.

### Kafka Cluster
- Serves as the central messaging hub.
- Ensures decoupled communication between services.
- Configured with a minimum of three brokers for fault tolerance.

### Kubernetes
- Manages the deployment and operation of microservices.
- Provides load balancing, scaling, and self-healing mechanisms.
- Utilizes Docker for service encapsulation.

## Message Types

### Video
```json
{
  "time": 0,
  "bits": [0, 1, 0, 1, ... , 0, 1, 1]
}
```

### Report
```json
{
  "channel": "",
  "time": 0,
  "match_times": [0]
}
```
## How to run

#### Requirements
- Minikube
- Docker
```
sudo chmod +x start_kube.sh
sudo chmod +x start_kafka.sh
sudo chmod +x start_services.sh
./start_kube.sh
./start_kafka.sh
./start_services.sh
```
After matching-service is started, run ```minikube service matching-service --url``` to get the service's endpoint and append it with ```/docs``` to access FastAPI's documentation page.

```kubectl get pods``` to get all the pods
- mock-producer will produce mock bits when start up
- mock-consumer pod will provide logs of the matching times in real time